<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <meta charset="utf-8"/>
    <title>Dashboard | Hyper - Responsive Bootstrap 5 Admin Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta
            content="A fully featured admin theme which can be used to build CRM, CMS, etc."
            name="description"
    />
    <meta content="Coderthemes" name="author"/>
    <script src="https://code.highcharts.com/highcharts.js"></script>

    <!-- App favicon -->
    <link rel="shortcut icon" href="{% static 'assets/images/favicon.ico' %}"/>

    <!-- Daterangepicker css -->
    <link rel="stylesheet" href="{% static 'assets/vendor/daterangepicker/daterangepicker.css' %}"/>

    <!-- Vector Map css -->
    <link rel="stylesheet"
          href="{% static 'assets/vendor/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.css' %}"/>

    <!-- Theme Config Js -->
    <script src="{% static 'assets/js/hyper-config.js' %}"></script>

    <!-- App css -->
    <link href="{% static 'assets/css/app-saas.min.css' %}" rel="stylesheet" type="text/css" id="app-style"/>

    <!-- Icons css -->
    <link href="{% static 'assets/css/icons.min.css' %}" rel="stylesheet" type="text/css"/>

</head>
<style>
    #divisionSelect,#districtSelect,#tehsilSelect,#ucSelect{
    width:auto;
    border-radius:10px;
    text-align:center;
    }

</style>
<body>
<!-- Begin page -->
<div class="wrapper">
    <!-- ========== Topbar Start ========== -->
    {% block content %}
    {% include 'topbar.html' %}

    <!-- ========== Topbar End ========== -->

    <!-- ========== Left Sidebar Start ========== -->
    {% include 'sidebar.html'%}

    <!-- ========== Left Sidebar End ========== -->

    <!-- ============================================================== -->
    <!-- Start Page Content here -->
    <!-- ============================================================== -->

    <div class="content-page">
        <div class="content">
            <!-- Start Content-->
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box">
                            <div class="page-title-right">
                                <form class="d-flex">

                                    <div class="input-group">
                                        <label for="divisionSelect">Select Division</label>
                                        <select class="form-control" id="divisionSelect">
                                            {% for division in divisions %}
                                            <option value="{{ division.id }}">{{ division.division }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="input-group">
                                        <label for="districtSelect">Select District</label>
                                        <select class="form-control" id="districtSelect" disabled>
                                            <!-- District options will be dynamically added here using JavaScript -->
                                        </select>
                                    </div>
                                    <div class="input-group">
                                        <label for="tehsilSelect">Select Tehsil</label>
                                        <select class="form-control" id="tehsilSelect" disabled>
                                            <!-- Tehsil options will be dynamically added here using JavaScript -->
                                        </select>
                                    </div>

                                    <div class="input-group">
                                        <label for="ucSelect">Select UC</label>
                                        <select class="form-control" id="ucSelect" disabled>
                                            <!-- UC options will be dynamically added here using JavaScript -->
                                        </select>
                                    </div>


                                </form>
                            </div>
                            <h4 class="page-title">Dashboard</h4>
                        </div>
                    </div>
                </div>

                <div class="row row">
                    <div class="col-xl-5 col-lg-6">
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="card widget-flat">
                                    <div class="card-body">
                                        <div class="float-end">
                                            <i class="mdi mdi-account-multiple widget-icon"></i>
                                        </div>
                                        <h5
                                                class="text-muted fw-normal mt-0"
                                                title="Number of Customers"
                                        >
                                            Customers
                                        </h5>
                                        <h3 class="mt-3 mb-3">36,254</h3>
                                        <p class="mb-0 text-muted">
                          <span class="text-success me-2"
                          ><i class="mdi mdi-arrow-up-bold"></i> 5.27%</span
                          >
                                            <span class="text-nowrap">Since last month</span>
                                        </p>
                                    </div>
                                    <!-- end card-body-->
                                </div>
                                <!-- end card-->
                            </div>
                            <!-- end col-->
                            <div class="col-sm-6">
                                <div class="card widget-flat">
                                    <div class="card-body">
                                        <div class="float-end">
                                            <i class="mdi mdi-cart-plus widget-icon"></i>
                                        </div>
                                        <h5
                                                class="text-muted fw-normal mt-0"
                                                title="Number of Orders"
                                        >
                                            Orders
                                        </h5>
                                        <h3 class="mt-3 mb-3">5,543</h3>
                                        <p class="mb-0 text-muted">
                          <span class="text-danger me-2"
                          ><i class="mdi mdi-arrow-down-bold"></i> 1.08%</span
                          >
                                            <span class="text-nowrap">Since last month</span>
                                        </p>
                                    </div>
                                    <!-- end card-body-->
                                </div>
                                <!-- end card-->
                            </div>
                            <!-- end col-->
                            <div class="col-sm-6">
                                <div class="card widget-flat">
                                    <div class="card-body">
                                        <div class="float-end">
                                            <i class="mdi mdi-currency-usd widget-icon"></i>
                                        </div>
                                        <h5
                                                class="text-muted fw-normal mt-0"
                                                title="Average Revenue"
                                        >
                                            Revenue
                                        </h5>
                                        <h3 class="mt-3 mb-3">$6,254</h3>
                                        <p class="mb-0 text-muted">
                          <span class="text-danger me-2"
                          ><i class="mdi mdi-arrow-down-bold"></i> 7.00%</span
                          >
                                            <span class="text-nowrap">Since last month</span>
                                        </p>
                                    </div>
                                    <!-- end card-body-->
                                </div>
                                <!-- end card-->
                            </div>
                            <!-- end col-->
                            <div class="col-sm-6">
                                <div class="card widget-flat">
                                    <div class="card-body">
                                        <div class="float-end">
                                            <i class="mdi mdi-account-multiple"></i>
                                        </div>
                                        <h5
                                                class="text-muted fw-normal mt-0"
                                                title="Average Revenue"
                                        >
                                            Population:
                                        </h5>
                                        <h3 class="mt-3 mb-3" id="m3"></h3>

                                    </div>
                                    <!-- end card-body-->
                                </div>
                                <!-- end card-->
                            </div>
                            <!-- end col-->


                        </div>
                        <!-- end row -->


                    </div>
                    <!-- end col -->
                </div>

                <!-- end row -->

                <!-- end row -->

                <!-- container -->
                    <div id="barChartContainer" style="height: 400px;"></div>

<!-- Container for the Stacked Bar Chart -->
<div id="stackedBarChartContainer" style="height: 400px;"></div>

<!-- Container for the Pie Chart -->
<div id="pieChartContainer" style="height: 400px;"></div>

                <div id="chart1"></div>

                <!-- Chart 2: Spline Chart -->
                <div id="chart2"></div>

                <!-- Chart 3: Area Chart -->
                <div id="chart3"></div>

                <!-- Chart 4: Bar Chart -->
                <div id="chart4"></div>

                <!-- Chart 5: Column Chart -->
                <div id="chart5"></div>

                <!-- Chart 6: Pie Chart -->
                <div id="chart6"></div>

                <!-- Chart 7: Scatter Plot -->
                <div id="chart7"></div>
            </div>
            <!-- content -->
        </div>
        <!-- Footer Start -->
        <footer class="footer">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <script>
                            document.write(new Date().getFullYear());
                        </script>
                        Â© Hyper - Coderthemes.com
                    </div>
                    <div class="col-md-6">
                        <div class="text-md-end footer-links d-none d-md-block">
                            <a href="javascript: void(0);">About</a>
                            <a href="javascript: void(0);">Support</a>
                            <a href="javascript: void(0);">Contact Us</a>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- end Footer -->
    </div>


    <!-- ============================================================== -->
    <!-- End Page content -->
    <!-- ============================================================== -->
    <!-- ========== Left Sidebar Start ========== -->

    <!-- END wrapper -->

    <!-- Theme Settings -->
    {% include 'theme.html' %}
    {% endblock %}


    <!-- Vendor js -->
    <script src="{% static 'assets/js/vendor.min.js' %}"></script>

    <!-- Daterangepicker js -->
    <script src="{% static 'assets/vendor/daterangepicker/moment.min.js' %}"></script>
    <script src="{% static 'assets/vendor/daterangepicker/daterangepicker.js' %}"></script>

    <!-- Apex Charts js -->
    <script src="{% static 'assets/vendor/apexcharts/apexcharts.min.js' %}"></script>

    <!-- Vector Map js -->
    <script src="{% static 'assets/vendor/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.min.js' %}"></script>
    <script src="{% static 'assets/vendor/admin-resources/jquery.vectormap/maps/jquery-jvectormap-world-mill-en.js' %}"></script>

    <!-- Dashboard App js -->
    <script src="{% static 'assets/js/pages/demo.dashboard.js' %}"></script>

    <!-- App js -->
    <script src="{% static 'assets/js/app.min.js' %}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
$(document).ready(function(){
    // When a division is selected
    $("#divisionSelect").change(function(){
        var divisionId = $(this).val();

        $("#districtSelect").prop("disabled", true);
        $("#tehsilSelect").prop("disabled", true);
        $("#ucSelect").prop("disabled", true);

        $("#districtSelect, #tehsilSelect, #ucSelect").empty();

        if (divisionId !== "") {
            $.ajax({
                url: '/get_districts/',
                type: 'GET',
                data: {'division_id': divisionId},
                dataType: 'json',
                success: function(data){
                    $("#districtSelect").prop("disabled", false);

                    $.each(data, function(key, value){
                        $("#districtSelect").append('<option value="' + key + '">' + value + '</option>');
                    });

                    updatePopulation(divisionId, null, null, null);
                     updateChar(divisionId, null, null, null);

                }
            });
        }
    });

    // When a district is selected
    $("#districtSelect").change(function(){
        var districtId = $(this).val();

        $("#tehsilSelect").prop("disabled", true);
        $("#ucSelect").prop("disabled", true);

        $("#tehsilSelect, #ucSelect").empty();

        if (districtId !== "") {
            $.ajax({
                url: '/get_tehsils/',
                type: 'GET',
                data: {'district_id': districtId},
                dataType: 'json',
                success: function(data){
                    $("#tehsilSelect").prop("disabled", false);

                    $.each(data, function(key, value){
                        $("#tehsilSelect").append('<option value="' + key + '">' + value + '</option>');
                    });

                    var divisionId = $("#divisionSelect").val();
                    updatePopulation(divisionId, districtId, null, null);
                    updateChar(divisionId, districtId, null, null);

                }
            });
        }
    });

    // When a tehsil is selected
    $("#tehsilSelect").change(function(){
        var tehsilId = $(this).val();

        $("#ucSelect").prop("disabled", true);
        $("#ucSelect").empty();

        if (tehsilId !== "") {
            $.ajax({
                url: '/get_ucs/',
                type: 'GET',
                data: {'tehsil_id': tehsilId},
                dataType: 'json',
                success: function(data){
                    $("#ucSelect").prop("disabled", false);

                    $.each(data, function(key, value){
                        $("#ucSelect").append('<option value="' + key + '">' + value + '</option>');
                    });

                    var divisionId = $("#divisionSelect").val();
                    var districtId = $("#districtSelect").val();
                    updatePopulation(divisionId, districtId, tehsilId, null);
                    updateChar(divisionId, districtId, tehsilId, null);

                }
            });
        }
    });

    // When a UC is selected
    $("#ucSelect").change(function(){
        var ucId = $(this).val();
        var divisionId = $("#divisionSelect").val();
        var districtId = $("#districtSelect").val();
        var tehsilId = $("#tehsilSelect").val();

        updatePopulation(divisionId, districtId, tehsilId, ucId);
        updateChar(divisionId, districtId, tehsilId, ucId);

    });

    // Function to update the population based on selected filters
    function updatePopulation(divisionId, districtId, tehsilId, ucId) {
        $.ajax({
            url: '/get_population/',
            type: 'GET',
            data: {
                'division_id': divisionId,
                'district_id': districtId,
                'tehsil_id': tehsilId,
                'uc_id': ucId,
            },
            dataType: 'json',
            success: function(data){
                console.log("Population data received:", data);
                $("#m3").text(data.total_population);            },
            error: function(xhr, status, error) {
                console.error("AJAX Error:", status, error);
            }
        });
    }

    function updateCharts(data) {
    Highcharts.chart('barChartContainer', {
        chart: {
            type: 'bar'
        },
        title: {
            text: 'Bar Chart for Counts'
        },
        xAxis: {
            categories: ["Newborns Weighted", "6 Months Old Children", "6-59 Months Old Children", "12-23 Months Old Children"],
            title: {
                text: 'Health Metrics'
            }
        },
        yAxis: {
            title: {
                text: 'Count'
            }
        },
        series: [{
            name: 'Counts',
            data: [data.total_newborns_weighted, data.age_group_counts.no_6_months_old_children__sum, data.age_group_counts.no_6_59_months_old_children__sum, data.age_group_counts.no_12_23_months_old_children__sum],
        }]
    });

    // Stacked Bar Chart
    Highcharts.chart('stackedBarChartContainer', {
        chart: {
            type: 'bar'
        },
        title: {
            text: 'Stacked Bar Chart for Age Groups'
        },
        xAxis: {
            categories: ["Newborns Weighted", "6 Months Old Children", "6-59 Months Old Children", "12-23 Months Old Children"],
            title: {
                text: 'Age Groups'
            }
        },
        yAxis: {
            title: {
                text: 'Count'
            }
        },
        plotOptions: {
            series: {
                stacking: 'normal'
            }
        },
        series: Object.keys(data.age_group_counts).map(category => ({
            name: category,
            data: [data.age_group_counts[category]],
        })),
    });

    // Pie Chart
    Highcharts.chart('pieChartContainer', {
        chart: {
            type: 'pie'
        },
        title: {
            text: 'Pie Chart for Percentage Distribution'
        },
        series: [{
            name: 'Percentage',
            data: [
                { name: 'Fully Immunized', y: data.fully_immunized_percentage },
                { name: 'Not Fully Immunized', y: 100 - data.fully_immunized_percentage },
            ],
        }],
    });
}

    // Make an AJAX call to fetch data
    function updateChar(divisionId, districtId, tehsilId, ucId) {
    $.ajax({
        url: '/get_child/',  // Replace with the actual URL to fetch data
        method: 'GET',
        data: {
                'division_id': divisionId,
                'district_id': districtId,
                'tehsil_id': tehsilId,
                'uc_id': ucId,
            },
        dataType: 'json',
        success: function(response) {
            // Assuming the response is in the same format as your 'data' variable
            updateCharts(response);
        },
        error: function(error) {
            console.error('Error fetching data:', error);
        }
    });
    }
});
</script>

    <script>
        // Sample data for charts
        const data1 = [5, 10, 15, 20, 25];
        const data2 = [10, 20, 30, 40, 50];
        const data3 = [15, 25, 10, 30, 20];
        const data4 = [5, 15, 25, 35, 45];
        const data5 = [20, 15, 25, 10, 30];
        const data6 = [{ name: 'A', y: 40 }, { name: 'B', y: 60 }];
        const data7 = [[1, 2], [2, 3], [3, 4], [4, 5], [5, 6]];

        // Initialize and configure charts
        function initializeChart(chartId, title, data, type) {
            Highcharts.chart(chartId, {
                chart: {
                    type: type
                },
                title: {
                    text: title
                },
                series: [{
                    data: data
                }]
            });
        }

        // Chart configurations
        initializeChart('chart1', 'Line Chart', data1, 'line');
        initializeChart('chart2', 'Spline Chart', data2, 'spline');
        initializeChart('chart3', 'Area Chart', data3, 'area');
        initializeChart('chart4', 'Bar Chart', data4, 'bar');
        initializeChart('chart5', 'Column Chart', data5, 'column');
        initializeChart('chart6', 'Pie Chart', data6, 'pie');
        initializeChart('chart7', 'Scatter Plot', data7, 'scatter');

    </script>

</body>


</html>
